const winLocAddedEnv = {
  expression: `(function () {
  const nonAdded = new Set(['WebGL2RenderingContext', 'Object', 'WebGLRenderingContext', 'Path2D', 'Function', 'CanvasPattern', 'CanvasGradient', 'Array', 'NavigationPreloadManager', 'webkitSpeechRecognitionEvent', 'webkitSpeechRecognitionError', 'Number', 'webkitSpeechRecognition', 'parseFloat', 'webkitSpeechGrammarList', 'webkitSpeechGrammar', 'SpeechSynthesisUtterance', 'parseInt', 'SpeechSynthesisEvent', 'Infinity', 'RemotePlayback', 'PushSubscriptionOptions', 'PushSubscription', 'NaN', 'PushManager', 'PresentationReceiver', 'undefined', 'PresentationConnectionList', 'PresentationRequest', 'Boolean', 'PresentationConnectionCloseEvent', 'String', 'PresentationConnectionAvailableEvent', 'PresentationConnection', 'PresentationAvailability', 'Symbol', 'Presentation', 'Date', 'PermissionStatus', 'Permissions', 'Promise', 'Notification', 'CanvasCaptureMediaStreamTrack', 'PhotoCapabilities', 'RegExp', 'MediaSettingsRange', 'Error', 'ImageCapture', 'StorageManager', 'EvalError', 'BudgetService', 'BroadcastChannel', 'SyncManager', 'RangeError', 'webkitRTCPeerConnection', 'webkitMediaStream', 'ReferenceError', 'WebSocket', 'SyntaxError', 'WebGLVertexArrayObject', 'WebGLUniformLocation', 'TypeError', 'WebGLTransformFeedback', 'WebGLTexture', 'URIError', 'WebGLSync', 'WebGLShaderPrecisionFormat', 'WebGLShader', 'JSON', 'WebGLSampler', 'Math', 'WebGLRenderbuffer', 'WebGLQuery', 'console', 'WebGLProgram', 'WebGLFramebuffer', 'WebGLContextEvent', 'Intl', 'WebGLBuffer', 'ArrayBuffer', 'WebGLActiveInfo', 'WaveShaperNode', 'Uint8Array', 'TextEncoder', 'TextDecoder', 'SubtleCrypto', 'Int32Array', 'StorageEvent', 'Uint32Array', 'Storage', 'StereoPannerNode', 'SourceBufferList', 'Int8Array', 'SourceBuffer', 'Uint16Array', 'ServiceWorkerRegistration', 'ServiceWorkerContainer', 'ServiceWorker', 'Int16Array', 'ScriptProcessorNode', 'Float32Array', 'ScreenOrientation', 'Response', 'Request', 'Float64Array', 'RTCStatsReport', 'RTCSessionDescription', 'Uint8ClampedArray', 'RTCRtpReceiver', 'RTCRtpContributingSource', 'DataView', 'RTCPeerConnectionIceEvent', 'Map', 'RTCPeerConnection', 'RTCIceCandidate', 'Set', 'RTCDataChannelEvent', 'RTCDataChannel', 'WeakMap', 'RTCCertificate', 'Plugin', 'PluginArray', 'WeakSet', 'PeriodicWave', 'Proxy', 'PasswordCredential', 'PannerNode', 'OscillatorNode', 'Reflect', 'OfflineAudioContext', 'OfflineAudioCompletionEvent', 'decodeURI', 'MimeType', 'decodeURIComponent', 'MimeTypeArray', 'MediaStreamTrackEvent', 'MediaStreamTrack', 'encodeURI', 'MediaStreamEvent', 'encodeURIComponent', 'MediaStream', 'MediaStreamAudioSourceNode', 'escape', 'MediaStreamAudioDestinationNode', 'MediaSource', 'unescape', 'MediaRecorder', 'MediaKeys', 'eval', 'MediaKeySystemAccess', 'MediaKeyStatusMap', 'MediaKeySession', 'isFinite', 'MediaKeyMessageEvent', 'isNaN', 'MediaEncryptedEvent', 'MediaElementAudioSourceNode', 'ByteLengthQueuingStrategy', 'MediaDevices', 'MediaDeviceInfo', 'MIDIPort', 'CountQueuingStrategy', 'MIDIOutputMap', 'MIDIOutput', 'ReadableStream', 'MIDIMessageEvent', 'MIDIInputMap', 'WritableStream', 'MIDIInput', 'MIDIConnectionEvent', 'stop', 'MIDIAccess', 'ImageBitmapRenderingContext', 'open', 'IIRFilterNode', 'alert', 'IDBVersionChangeEvent', 'IDBTransaction', 'IDBRequest', 'confirm', 'IDBOpenDBRequest', 'prompt', 'IDBObjectStore', 'IDBKeyRange', 'IDBIndex', 'print', 'IDBFactory', 'requestAnimationFrame', 'IDBDatabase', 'IDBCursorWithValue', 'IDBCursor', 'cancelAnimationFrame', 'Headers', 'requestIdleCallback', 'GamepadEvent', 'Gamepad', 'GamepadButton', 'cancelIdleCallback', 'GainNode', 'FederatedCredential', 'captureEvents', 'EventSource', 'DynamicsCompressorNode', 'releaseEvents', 'DeviceOrientationEvent', 'getComputedStyle', 'DeviceMotionEvent', 'DelayNode', 'matchMedia', 'DOMError', 'CryptoKey', 'moveTo', 'Crypto', 'CredentialsContainer', 'Credential', 'moveBy', 'ConvolverNode', 'resizeTo', 'ConstantSourceNode', 'CloseEvent', 'ChannelSplitterNode', 'resizeBy', 'ChannelMergerNode', 'CanvasRenderingContext2D', 'getSelection', 'CacheStorage', 'find', 'Cache', 'BlobEvent', 'BiquadFilterNode', 'getMatchedCSSRules', 'BeforeInstallPromptEvent', 'webkitRequestAnimationFrame', 'BatteryManager', 'BaseAudioContext', 'USBOutTransferResult','USBIsochronousOutTransferResult','USBIsochronousOutTransferPacket','USBIsochronousInTransferResult','USBIsochronousInTransferPacket','USBInTransferResult','USBInterface','USBEndpoint','USBDevice','USBConnectionEvent','USBConfiguration','USBAlternateInterface','USB','PaymentResponse','PaymentRequestUpdateEvent','PaymentRequest','PaymentAddress','VisualViewport','DOMRectReadOnly','DOMRect','DOMQuad','DOMPointReadOnly','DOMPoint','DOMMatrixReadOnly','DOMMatrix','NetworkInformation','Clipboard','visualViewport','AudioScheduledSourceNode', 'webkitCancelAnimationFrame', 'AudioProcessingEvent', 'btoa', 'AudioParam', 'AudioNode', 'atob', 'AudioListener', 'AudioDestinationNode', 'setTimeout', 'AudioContext', 'AudioBufferSourceNode', 'clearTimeout', 'AudioBuffer', 'AppBannerPromptResult', 'AnalyserNode', 'setInterval', 'postMessage', 'clearInterval', 'blur', 'focus', 'createImageBitmap', 'close', 'SVGMPathElement', 'SVGDiscardElement', 'scroll', 'SVGAnimationElement', 'scrollTo', 'XSLTProcessor', 'SharedWorker', 'PointerEvent', 'scrollBy', 'PerformancePaintTiming', 'fetch', 'PerformanceObserverEntryList', 'PerformanceObserver', 'PerformanceNavigationTiming', 'webkitRequestFileSystem', 'IntersectionObserverEntry', 'webkitResolveLocalFileSystemURL', 'IntersectionObserver', 'StaticRange', 'InputEvent', 'openDatabase', 'CustomElementRegistry', 'SharedArrayBuffer', 'XPathResult', 'XPathExpression', 'XPathEvaluator', 'Atomics', 'XMLSerializer', 'XMLHttpRequestUpload', 'XMLHttpRequestEventTarget', 'XMLHttpRequest', 'XMLDocument', 'Worker', 'Window', 'WheelEvent', 'WebKitCSSMatrix', 'ValidityState', 'VTTCue', 'URLSearchParams', 'URL', 'UIEvent', 'TreeWalker', 'TransitionEvent', 'chrome', 'TrackEvent', 'TouchList', 'WebAssembly', 'TouchEvent', 'Touch', 'TimeRanges', 'TextTrackList', 'TextTrackCueList', 'TextTrackCue', 'TextTrack', 'TextMetrics', 'TextEvent', 'Text', 'TaskAttributionTiming', 'StyleSheetList', 'StyleSheet', 'ShadowRoot', 'Selection', 'SecurityPolicyViolationEvent', 'Screen', 'SVGViewElement', 'SVGUseElement', 'SVGUnitTypes', 'SVGTransformList', 'SVGTransform', 'SVGTitleElement', 'SVGTextPositioningElement', 'SVGTextPathElement', 'SVGTextElement', 'SVGTextContentElement', 'SVGTSpanElement', 'SVGSymbolElement', 'SVGSwitchElement', 'SVGStyleElement', 'SVGStringList', 'SVGStopElement', 'SVGSetElement', 'SVGScriptElement', 'SVGSVGElement', 'SVGRectElement', 'SVGRect', 'SVGRadialGradientElement', 'SVGPreserveAspectRatio', 'SVGPolylineElement', 'SVGPolygonElement', 'SVGPointList', 'SVGPoint', 'SVGPatternElement', 'SVGPathElement', 'SVGNumberList', 'SVGNumber', 'SVGMetadataElement', 'SVGMatrix', 'SVGMaskElement', 'SVGMarkerElement', 'SVGLinearGradientElement', 'SVGLineElement', 'SVGLengthList', 'SVGLength', 'SVGImageElement', 'SVGGraphicsElement', 'SVGGradientElement', 'SVGGeometryElement', 'SVGGElement', 'SVGForeignObjectElement', 'SVGFilterElement', 'SVGFETurbulenceElement', 'SVGFETileElement', 'SVGFESpotLightElement', 'SVGFESpecularLightingElement', 'SVGFEPointLightElement', 'SVGFEOffsetElement', 'SVGFEMorphologyElement', 'SVGFEMergeNodeElement', 'SVGFEMergeElement', 'SVGFEImageElement', 'SVGFEGaussianBlurElement', 'SVGFEFuncRElement', 'SVGFEFuncGElement', 'SVGFEFuncBElement', 'SVGFEFuncAElement', 'SVGFEFloodElement', 'SVGFEDropShadowElement', 'SVGFEDistantLightElement', 'SVGFEDisplacementMapElement', 'SVGFEDiffuseLightingElement', 'SVGFEConvolveMatrixElement', 'SVGFECompositeElement', 'SVGFEComponentTransferElement', 'SVGFEColorMatrixElement', 'SVGFEBlendElement', 'SVGEllipseElement', 'SVGElement', 'SVGDescElement', 'SVGDefsElement', 'SVGComponentTransferFunctionElement', 'SVGClipPathElement', 'SVGCircleElement', 'SVGAnimatedTransformList', 'SVGAnimatedString', 'SVGAnimatedRect', 'SVGAnimatedPreserveAspectRatio', 'SVGAnimatedNumberList', 'SVGAnimatedNumber', 'SVGAnimatedLengthList', 'SVGAnimatedLength', 'SVGAnimatedInteger', 'SVGAnimatedEnumeration', 'SVGAnimatedBoolean', 'SVGAnimatedAngle', 'SVGAnimateTransformElement', 'SVGAnimateMotionElement', 'SVGAnimateElement', 'SVGAngle', 'SVGAElement', 'Range', 'RadioNodeList', 'PromiseRejectionEvent', 'ProgressEvent', 'ProcessingInstruction', 'PopStateEvent', 'PerformanceTiming', 'PerformanceResourceTiming', 'PerformanceNavigation', 'PerformanceMeasure', 'PerformanceMark', 'PerformanceLongTaskTiming', 'PerformanceEntry', 'Performance', 'PageTransitionEvent', 'NodeList', 'NodeIterator', 'NodeFilter', 'Node', 'Navigator', 'NamedNodeMap', 'MutationRecord', 'MutationObserver', 'MutationEvent', 'MouseEvent', 'MessagePort', 'MessageEvent', 'MessageChannel', 'MediaQueryListEvent', 'MediaQueryList', 'MediaList', 'MediaError', 'Location', 'KeyboardEvent', 'InputDeviceCapabilities', 'ImageData', 'ImageBitmap', 'IdleDeadline', 'History', 'HashChangeEvent', 'HTMLVideoElement', 'HTMLUnknownElement', 'HTMLUListElement', 'HTMLTrackElement', 'HTMLTitleElement', 'HTMLTextAreaElement', 'HTMLTemplateElement', 'HTMLTableSectionElement', 'HTMLTableRowElement', 'HTMLTableElement', 'HTMLTableColElement', 'HTMLTableCellElement', 'HTMLTableCaptionElement', 'HTMLStyleElement', 'HTMLSpanElement', 'HTMLSourceElement', 'HTMLSlotElement', 'HTMLShadowElement', 'HTMLSelectElement', 'HTMLScriptElement', 'HTMLQuoteElement', 'HTMLProgressElement', 'HTMLPreElement', 'HTMLPictureElement', 'HTMLParamElement', 'HTMLParagraphElement', 'HTMLOutputElement', 'HTMLOptionsCollection', 'Option', 'HTMLOptionElement', 'HTMLOptGroupElement', 'HTMLObjectElement', 'HTMLOListElement', 'HTMLModElement', 'HTMLMeterElement', 'HTMLMetaElement', 'HTMLMenuElement', 'HTMLMediaElement', 'HTMLMarqueeElement', 'HTMLMapElement', 'HTMLLinkElement', 'HTMLLegendElement', 'HTMLLabelElement', 'HTMLLIElement', 'HTMLInputElement', 'Image', 'HTMLImageElement', 'HTMLIFrameElement', 'HTMLHtmlElement', 'HTMLHeadingElement', 'HTMLHeadElement', 'HTMLHRElement', 'HTMLFrameSetElement', 'HTMLFrameElement', 'HTMLFormElement', 'HTMLFormControlsCollection', 'HTMLFontElement', 'HTMLFieldSetElement', 'HTMLEmbedElement', 'HTMLElement', 'HTMLDocument', 'HTMLDivElement', 'HTMLDirectoryElement', 'HTMLDialogElement', 'HTMLDetailsElement', 'HTMLDataListElement', 'HTMLDListElement', 'HTMLContentElement', 'HTMLCollection', 'HTMLCanvasElement', 'HTMLButtonElement', 'HTMLBodyElement', 'HTMLBaseElement', 'HTMLBRElement', 'Audio', 'HTMLAudioElement', 'HTMLAreaElement', 'HTMLAnchorElement', 'HTMLAllCollection', 'FormData', 'FontFaceSetLoadEvent', 'FontFace', 'FocusEvent', 'FileReader', 'FileList', 'File', 'EventTarget', 'Event', 'ErrorEvent', 'Element', 'DragEvent', 'DocumentType', 'DocumentFragment', 'Document', 'DataTransferItemList', 'DataTransferItem', 'DataTransfer', 'DOMTokenList', 'DOMStringMap', 'DOMStringList', 'DOMParser', 'DOMImplementation', 'DOMException', 'CustomEvent', 'CompositionEvent', 'Comment', 'ClipboardEvent', 'ClientRectList', 'ClientRect', 'CharacterData', 'CSSViewportRule', 'CSSSupportsRule', 'CSSStyleSheet', 'CSSStyleRule', 'CSSStyleDeclaration', 'CSSRuleList', 'CSSRule', 'CSSPageRule', 'CSSNamespaceRule', 'CSSMediaRule', 'CSSKeyframesRule', 'CSSKeyframeRule', 'CSSImportRule', 'CSSGroupingRule', 'CSSFontFaceRule', 'CSS', 'CSSConditionRule', 'CDATASection', 'Blob', 'BeforeUnloadEvent', 'BarProp', 'Attr', 'ApplicationCacheErrorEvent', 'ApplicationCache', 'AnimationEvent', 'frames', 'self', 'window', 'WebKitMutationObserver', 'webkitURL', 'WebKitAnimationEvent', 'WebKitTransitionEvent', 'parent', 'opener', 'top', 'length', 'closed', 'location', 'document', 'origin', 'name', 'history', 'locationbar', 'menubar', 'personalbar', 'scrollbars', 'statusbar', 'toolbar', 'status', 'frameElement', 'navigator', 'applicationCache', 'external', 'screen', 'innerWidth', 'innerHeight', 'scrollX', 'pageXOffset', 'scrollY', 'pageYOffset', 'screenX', 'screenY', 'outerWidth', 'outerHeight', 'devicePixelRatio', 'clientInformation', 'event', 'offscreenBuffering', 'screenLeft', 'screenTop', 'defaultStatus', 'defaultstatus', 'styleMedia', 'onanimationend', 'onanimationiteration', 'onanimationstart', 'onsearch', 'ontransitionend', 'onwebkitanimationend', 'onwebkitanimationiteration', 'onwebkitanimationstart', 'onwebkittransitionend', 'onwheel', 'isSecureContext', 'onabort', 'onblur', 'oncancel', 'oncanplay', 'oncanplaythrough', 'onchange', 'onclick', 'onclose', 'oncontextmenu', 'oncuechange', 'ondblclick', 'ondrag', 'ondragend', 'ondragenter', 'ondragleave', 'ondragover', 'ondragstart', 'ondrop', 'ondurationchange', 'onemptied', 'onended', 'onerror', 'onfocus', 'oninput', 'oninvalid', 'onkeydown', 'onkeypress', 'onkeyup', 'onload', 'onloadeddata', 'onloadedmetadata', 'onloadstart', 'onmousedown', 'onmouseenter', 'onmouseleave', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'onmousewheel', 'onpause', 'onplay', 'onplaying', 'onprogress', 'onratechange', 'onreset', 'onresize', 'onscroll', 'onseeked', 'onseeking', 'onselect', 'onshow', 'onstalled', 'onsubmit', 'onsuspend', 'ontimeupdate', 'ontoggle', 'onvolumechange', 'onwaiting', 'onbeforeunload', 'onhashchange', 'onlanguagechange', 'onmessage', 'onmessageerror', 'onoffline', 'ononline', 'onpagehide', 'onpageshow', 'onpopstate', 'onrejectionhandled', 'onstorage', 'onunhandledrejection', 'onunload', 'performance', 'onauxclick', 'customElements', 'ongotpointercapture', 'onlostpointercapture', 'onpointercancel', 'onpointerdown', 'onpointerenter', 'onpointerleave', 'onpointermove', 'onpointerout', 'onpointerover', 'onpointerup', 'crypto', 'ondevicemotion', 'ondeviceorientation', 'ondeviceorientationabsolute', 'indexedDB', 'webkitStorageInfo', 'sessionStorage', 'localStorage', 'caches', 'speechSynthesis'])
  let location
  if (window.location) {
    location = window.location.href
  } 
  return {
    location,
    addedEnvKeys: Reflect.ownKeys(window).filter(k => {
      if (nonAdded.has(k)) {
        return false
      }
      if (window[k] === undefined || window[k] === null) {
        return false
      }
      let ret = true
      try {
        ret = !String(window[k]).includes('[Command Line API]')
      } catch (error) {}
      return ret
    })
  }
})()`,
  generatePreview: true,
  returnByValue: true
}

function killAllJsAlertPromptConfirm (win) {
  Object.defineProperty(win, 'onbeforeunload', {
    configurable: false,
    writeable: false,
    value: function () {}
  })
  Object.defineProperty(win, 'onunload', {
    configurable: false,
    writeable: false,
    value: function () {}
  })
  window.alert = function () {}
  window.confirm = function () {}
  window.prompt = function () {}
  win.alert = function () {}
  win.confirm = function () {}
  win.prompt = function () {}
}

module.exports = {
  winLocAddedEnv,
  noNaughtyJs: {
    source: `(${killAllJsAlertPromptConfirm.toString()})(window);`
  },
  noNaughtyJS2: {
    scriptSource: `(${killAllJsAlertPromptConfirm.toString()})(window);`
  },
  justLoc: {
    expression: 'window.location.href',
    generatePreview: true,
    returnByValue: true
  }
}
